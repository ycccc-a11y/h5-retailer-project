# 涉企行政检查路线规划系统 - 使用手册

## 文档信息

- **文档版本**：v1.0
- **最后更新**：2024年
- **适用系统**：涉企行政检查路线规划系统
- **文档格式**：Markdown

---

## 目录

1. [系统简介](#1-系统简介)
2. [系统要求](#2-系统要求)
3. [快速开始](#3-快速开始)
4. [功能详解](#4-功能详解)
5. [操作指南](#5-操作指南)
6. [高级功能](#6-高级功能)
7. [常见问题](#7-常见问题)
8. [故障排查](#8-故障排查)
9. [附录](#9-附录)

---

## 1. 系统简介

### 1.1 系统概述

涉企行政检查路线规划系统是一个基于Web的智能路线规划平台，主要用于帮助行政检查人员优化检查路线，提高检查效率。系统通过整合许可证数据库、高德地图服务以及智能算法，实现检查点的智能排序、路线规划以及移动端导航功能。

### 1.2 核心功能

- ✅ **许可证号码搜索**：通过许可证号码快速定位企业位置
- ✅ **任务池管理**：分类管理重点检查、随机抽查、许可核查、日常检查等任务
- ✅ **智能路线规划**：基于蚁群算法优化检查点顺序，生成最优路线
- ✅ **起点设置**：支持搜索起点或使用当前位置作为起点
- ✅ **实时地图显示**：在地图上可视化显示规划路线和检查点位置
- ✅ **分段导航**：将规划路线分段，支持跳转到高德地图App进行逐段导航
- ✅ **动态规划**：支持自动刷新路线，适应任务变化

### 1.3 系统优势

- 🎯 **智能优化**：使用蚁群算法自动优化检查点顺序，减少总行程距离
- 🎯 **多端支持**：支持PC端和移动端访问，自动适配不同设备
- 🎯 **实时更新**：支持动态规划，自动适应任务变化
- 🎯 **导航集成**：无缝对接高德地图App，提供专业导航服务

---

## 2. 系统要求

### 2.1 硬件要求

- **CPU**：双核及以上
- **内存**：4GB及以上
- **存储**：至少100MB可用空间
- **网络**：稳定的互联网连接

### 2.2 软件要求

#### 服务器端
- **操作系统**：Windows 7/10/11、Linux、macOS
- **Python**：Python 3.6及以上版本
- **数据库**：MySQL 5.7及以上版本
- **浏览器**：Chrome、Firefox、Edge、Safari（最新版本）

#### 客户端
- **浏览器**：Chrome、Firefox、Edge、Safari、移动端浏览器（最新版本）
- **移动端**：支持GPS定位的智能手机或平板

### 2.3 网络要求

- 需要访问高德地图API服务
- 需要访问后端API服务（默认端口5001）
- 需要访问前端Web服务（默认端口8080）

### 2.4 权限要求

- **数据库访问权限**：需要MySQL数据库的读取权限
- **浏览器定位权限**：使用"使用当前位置"功能时需要授予浏览器定位权限
- **高德地图API Key**：需要有效的高德地图API Key（Web JS API类型）

---

## 3. 快速开始

### 3.1 系统部署

#### 3.1.1 启动后端API服务

1. **方式一：使用批处理文件（推荐）**
   - 双击运行 `start_api.bat` 文件
   - 看到提示信息："许可证查询API服务器启动，监听端口 5001"

2. **方式二：命令行启动**
   ```bash
   python license_api.py
   ```

#### 3.1.2 启动前端Web服务

1. **方式一：使用批处理文件（推荐）**
   - 双击运行 `启动前端服务器.bat` 文件

2. **方式二：命令行启动**
   ```bash
   # Python 3
   python -m http.server 8080
   
   # Python 2
   python -m SimpleHTTPServer 8080
   ```

#### 3.1.3 访问系统

1. **PC端访问**
   - 打开浏览器，访问：`http://localhost:8080`

2. **移动端访问**
   - 确保手机和电脑在同一WiFi网络
   - 获取电脑IP地址（Windows：`ipconfig`，Linux/Mac：`ifconfig`）
   - 在手机浏览器访问：`http://[电脑IP地址]:8080`
   - 例如：`http://192.168.1.35:8080`

### 3.2 首次使用

1. **检查服务状态**
   - 确认后端API服务已启动（端口5001）
   - 确认前端Web服务已启动（端口8080）

2. **打开系统**
   - 在浏览器中打开系统首页

3. **开始使用**
   - 系统会自动加载任务池数据
   - 可以开始选择任务并规划路线

---

## 4. 功能详解

### 4.1 许可证号码搜索

#### 4.1.1 功能说明

通过输入许可证号码，快速搜索并定位企业的位置信息。适用于临时添加检查任务或查找特定企业。

#### 4.1.2 操作步骤

1. 在"许可证号码搜索（临时任务）"区域，输入许可证号码
2. 点击"搜索"按钮
3. 系统显示搜索结果，包括：
   - 许可证号码
   - 商户名称
   - 经营地址
   - 经度、纬度
4. 点击"添加到路线"按钮，将企业添加到路线规划中

#### 4.1.3 注意事项

- 许可证号码必须准确，否则可能搜索不到结果
- 搜索结果会自动显示在地图上
- 添加后的任务会出现在"已选检查对象"列表中

### 4.2 任务池管理

#### 4.2.1 功能说明

系统提供四个任务分类，用于管理不同类型的检查任务：
- **重点检查**：需要重点关注的检查对象
- **随机抽查**：随机抽取的检查对象
- **许可核查**：需要核查许可证的检查对象
- **日常检查**：日常例行检查对象

#### 4.2.2 操作步骤

1. **展开任务分类**
   - 点击分类标题（如"重点检查"）展开/折叠任务列表
   - 首次展开时会自动加载该分类的任务数据

2. **选择任务**
   - 勾选需要检查的任务复选框
   - 可以同时选择多个分类中的多个任务

3. **添加许可证**
   - 点击分类标题旁的"＋"按钮
   - 输入许可证号码进行搜索
   - 将搜索结果添加到对应分类

#### 4.2.3 任务信息

每个任务显示以下信息：
- 任务名称（商户名称）
- 经营地址
- 分类标签（重点检查/随机抽查/许可核查/日常检查）

### 4.3 起点设置

#### 4.3.1 功能说明

设置路线规划的起点位置，可以选择：
- 搜索指定地点作为起点
- 使用当前位置作为起点（需要浏览器定位权限）

#### 4.3.2 操作步骤

**方式一：搜索起点**

1. 在"起点搜索"输入框中输入地点名称或地址
2. 点击"搜索"按钮或按Enter键
3. 系统显示搜索结果，选择合适的地点作为起点
4. 起点设置成功后，会显示在输入框下方

**方式二：使用当前位置**

1. 点击"使用当前位置"按钮
2. 浏览器会请求定位权限，点击"允许"
3. 系统自动获取当前位置并设置为起点

**清除起点**

- 点击起点信息旁的"×"按钮，或点击"清除起点"按钮

#### 4.3.3 注意事项

- 起点是可选的，不设置起点时，系统会以第一个检查点作为起点
- 使用当前位置功能需要浏览器定位权限
- HTTPS环境下定位功能更稳定

### 4.4 智能路线规划

#### 4.4.1 功能说明

系统使用蚁群算法智能优化检查点顺序，生成最短或最优的检查路线。算法会自动考虑所有检查点的位置关系，计算出总距离最短的路线。

#### 4.4.2 操作步骤

1. **选择检查任务**
   - 在任务池中勾选需要检查的任务
   - 系统会实时显示已选任务数量

2. **设置起点（可选）**
   - 搜索起点或使用当前位置

3. **规划路线**
   - 点击"一键智能规划路线"按钮
   - 系统开始计算最优路线

4. **查看结果**
   - 路线规划完成后，系统会：
     - 在地图上显示路线和检查点
     - 显示路线详情（总距离、预计时间、检查点列表）
     - 显示优化信息（如果使用了蚁群算法）

#### 4.4.3 算法说明

**蚁群算法优化**

- **触发条件**：当检查点数量≥4个时，系统会自动启用蚁群算法优化
- **优化目标**：最小化总行程距离
- **算法参数**：
  - 迭代次数：80次
  - 蚂蚁数量：检查点数量的2倍
  - 信息素重要度（α）：1.1
  - 启发式重要度（β）：4.5
  - 信息素挥发率（ρ）：0.45

**路线规划策略**

- **策略1（默认）**：最短距离
- **策略0**：最快时间
- **策略2**：避开高速
- **策略3**：不走高速

#### 4.4.4 路线显示

规划完成后，系统会显示：

1. **地图可视化**
   - 起点标记（蓝色圆点）
   - 检查点标记（红色标记）
   - 路线路径（蓝色线条）
   - 路线方向箭头

2. **路线详情**
   - 总距离（公里）
   - 预计时间（分钟）
   - 检查点列表（按顺序显示）
   - 每段距离和预计时间

3. **优化信息**
   - 是否使用蚁群算法优化
   - 优化后的总距离

### 4.5 地图可视化

#### 4.5.1 功能说明

系统使用高德地图显示规划路线和检查点位置，提供直观的可视化效果。

#### 4.5.2 地图功能

- **缩放**：使用鼠标滚轮或地图控件缩放地图
- **拖拽**：点击并拖拽地图移动视角
- **标记**：
  - 起点：蓝色圆点标记
  - 检查点：红色标记，显示序号和名称
  - 路线：蓝色线条连接所有检查点

#### 4.5.3 交互操作

- 点击检查点标记可以查看详细信息
- 地图会自动调整视野，显示所有检查点
- 路线会以平滑曲线显示，反映实际道路情况

### 4.6 分段导航

#### 4.6.1 功能说明

系统将规划路线分成多个路段，每个路段可以单独导航。点击导航按钮会跳转到高德地图App进行导航。

#### 4.6.2 操作步骤

1. **查看路线详情**
   - 在路线详情区域，可以看到所有路段列表
   - 每个路段显示：起点、终点、距离、预计时间

2. **开始导航**
   - 点击路段旁的"打开高德地图导航此段"按钮
   - 系统会跳转到高德地图App
   - 在高德地图App中开始导航

3. **逐段导航**
   - 完成当前路段导航后，返回系统
   - 继续点击下一路段的导航按钮

#### 4.6.3 注意事项

- 需要手机安装高德地图App
- 首次使用可能需要授权跳转权限
- 如果未安装高德地图App，会提示下载

---

## 5. 操作指南

### 5.1 完整工作流程

#### 场景一：日常检查路线规划

1. **准备阶段**
   - 启动后端API服务
   - 启动前端Web服务
   - 打开系统首页

2. **选择任务**
   - 展开"日常检查"分类
   - 勾选需要检查的任务（可多选）
   - 如需添加临时任务，使用许可证搜索功能

3. **设置起点**
   - 点击"使用当前位置"或搜索起点位置

4. **规划路线**
   - 点击"一键智能规划路线"
   - 等待系统计算最优路线

5. **查看路线**
   - 在地图上查看路线和检查点
   - 查看路线详情和预计时间

6. **开始检查**
   - 点击第一段的导航按钮
   - 在高德地图App中开始导航
   - 到达检查点后，完成检查
   - 继续导航到下一个检查点

#### 场景二：多类型任务混合规划

1. **选择多类型任务**
   - 展开"重点检查"分类，选择任务
   - 展开"随机抽查"分类，选择任务
   - 展开"许可核查"分类，选择任务

2. **统一规划**
   - 系统会将所有选中的任务合并
   - 使用蚁群算法优化整体顺序
   - 生成一条最优路线

3. **执行检查**
   - 按照规划路线依次完成检查
   - 系统会显示每个任务的分类标签

### 5.2 常用操作技巧

#### 5.2.1 快速选择任务

- 使用浏览器的查找功能（Ctrl+F）快速定位任务
- 可以同时展开多个分类，方便对比选择

#### 5.2.2 调整路线

- 如果对规划结果不满意，可以：
  - 取消选择某些任务，重新规划
  - 调整起点位置
  - 手动调整任务选择顺序（通过取消和重新选择）

#### 5.2.3 保存路线

- 当前版本不支持路线保存功能
- 建议截图保存重要路线信息
- 或记录检查点顺序，便于后续参考

---

## 6. 高级功能

### 6.1 动态规划

#### 6.1.1 功能说明

系统支持动态规划功能，可以自动刷新路线，适应任务变化。当任务选择发生变化时，系统会自动重新规划路线。

#### 6.1.2 启用方式

- 动态规划功能默认启用
- 系统会在以下情况自动刷新路线：
  - 任务选择发生变化（延迟1.2秒后刷新）
  - 定时自动刷新（默认间隔120秒）

#### 6.1.3 配置选项

- **刷新间隔**：可设置自动刷新的时间间隔（默认120秒）
- **规划策略**：可选择不同的路线规划策略

#### 6.1.4 手动刷新

- 点击"刷新路线"按钮可以手动触发路线刷新
- 适用于需要立即更新路线的情况

### 6.2 蚁群算法配置

#### 6.2.1 算法参数

系统使用蚁群算法优化检查点顺序，主要参数包括：

- **最小点数**：当检查点数量≥4时启用算法
- **迭代次数**：80次（可调整）
- **蚂蚁数量**：检查点数量的2倍
- **信息素重要度（α）**：1.1
- **启发式重要度（β）**：4.5
- **信息素挥发率（ρ）**：0.45
- **信息素强度（Q）**：0.9

#### 6.2.2 参数调整

如需调整算法参数，可以修改 `script.js` 文件中的 `ANT_COLONY_CONFIG` 配置：

```javascript
const ANT_COLONY_CONFIG = {
    enabled: true,        // 是否启用蚁群算法
    minPoints: 4,         // 最小检查点数量
    iterations: 80,       // 迭代次数
    antMultiplier: 2,     // 蚂蚁数量倍数
    alpha: 1.1,           // 信息素重要度
    beta: 4.5,            // 启发式重要度
    rho: 0.45,            // 信息素挥发率
    q: 0.9                // 信息素强度
};
```

### 6.3 路线规划策略

#### 6.3.1 策略说明

系统支持多种路线规划策略：

- **策略1（默认）**：最短距离
  - 适用于：希望总行程最短的情况
  - 特点：可能经过较多红绿灯或拥堵路段

- **策略0**：最快时间
  - 适用于：希望尽快完成检查的情况
  - 特点：可能距离稍长，但时间更短

- **策略2**：避开高速
  - 适用于：城市内检查，避免上高速
  - 特点：路线更贴近城市道路

- **策略3**：不走高速
  - 适用于：完全避免高速路段
  - 特点：只走普通道路

#### 6.3.2 策略选择

- 在路线规划前，可以通过界面选择规划策略
- 不同策略会影响路线规划结果
- 建议根据实际需求选择合适的策略

---

## 7. 常见问题

### 7.1 功能相关问题

#### Q1: 为什么搜索不到许可证信息？

**A:** 可能的原因：
1. 许可证号码输入错误
2. 数据库中不存在该许可证
3. 后端API服务未启动
4. 网络连接问题

**解决方法：**
- 检查许可证号码是否正确
- 确认后端API服务已启动（端口5001）
- 检查网络连接
- 查看浏览器控制台错误信息

#### Q2: 蚁群算法没有优化路线？

**A:** 可能的原因：
1. 检查点数量少于4个（算法不启用）
2. 算法配置被禁用
3. 算法计算失败

**解决方法：**
- 确保检查点数量≥4个
- 检查 `ANT_COLONY_CONFIG.enabled` 是否为 `true`
- 查看浏览器控制台日志

#### Q3: 地图不显示或显示异常？

**A:** 可能的原因：
1. 高德地图API Key配置错误
2. 网络连接问题
3. 浏览器兼容性问题

**解决方法：**
- 检查高德地图API Key是否正确
- 确认网络连接正常
- 尝试使用Chrome浏览器
- 查看浏览器控制台错误信息

#### Q4: 无法使用"使用当前位置"功能？

**A:** 可能的原因：
1. 浏览器未授予定位权限
2. 设备GPS未开启
3. 非HTTPS环境（部分浏览器要求）

**解决方法：**
- 在浏览器设置中允许定位权限
- 开启设备GPS功能
- 使用HTTPS访问（生产环境）
- 使用搜索功能手动输入起点

#### Q5: 跳转到高德地图App失败？

**A:** 可能的原因：
1. 手机未安装高德地图App
2. 浏览器阻止了跳转
3. URL Scheme不支持

**解决方法：**
- 安装高德地图App
- 在浏览器设置中允许跳转到其他应用
- 使用高德地图网页版导航

### 7.2 技术相关问题

#### Q6: 后端API服务启动失败？

**A:** 可能的原因：
1. 端口5001被占用
2. Python环境问题
3. 依赖库未安装

**解决方法：**
- 检查端口占用：`netstat -ano | findstr 5001`
- 确认Python版本：`python --version`
- 安装依赖：`pip install pymysql flask`
- 查看错误日志

#### Q7: 数据库连接失败？

**A:** 可能的原因：
1. MySQL服务未启动
2. 数据库配置错误
3. 网络连接问题

**解决方法：**
- 启动MySQL服务
- 检查 `db_config.py` 中的数据库配置
- 测试数据库连接：`python mysql_test.py`
- 确认数据库名称和表名正确

#### Q8: 手机无法访问系统？

**A:** 可能的原因：
1. 手机和电脑不在同一WiFi网络
2. 防火墙阻止了端口访问
3. IP地址不正确

**解决方法：**
- 确保手机和电脑在同一WiFi网络
- 配置防火墙允许8080和5001端口
- 使用正确的电脑IP地址访问
- 参考"手机测试说明.md"文档

---

## 8. 故障排查

### 8.1 系统无法启动

#### 问题现象
- 后端API服务无法启动
- 前端页面无法访问
- 浏览器显示连接错误

#### 排查步骤

1. **检查服务状态**
   ```bash
   # 检查端口占用
   netstat -ano | findstr 5001  # 后端端口
   netstat -ano | findstr 8080  # 前端端口
   ```

2. **检查Python环境**
   ```bash
   python --version
   pip list
   ```

3. **检查依赖库**
   ```bash
   pip install pymysql flask
   ```

4. **查看错误日志**
   - 后端服务：查看命令行输出
   - 前端：查看浏览器控制台（F12）

### 8.2 功能异常

#### 问题现象
- 许可证搜索无结果
- 路线规划失败
- 地图不显示

#### 排查步骤

1. **检查API服务**
   - 确认后端API服务运行正常
   - 测试API接口：`http://localhost:5001/api/search/license/[许可证号]`

2. **检查网络连接**
   - 确认可以访问高德地图API
   - 检查防火墙设置

3. **检查浏览器控制台**
   - 按F12打开开发者工具
   - 查看Console标签页的错误信息
   - 查看Network标签页的请求状态

4. **检查数据库**
   - 确认MySQL服务运行正常
   - 测试数据库连接
   - 检查数据表是否存在

### 8.3 性能问题

#### 问题现象
- 路线规划速度慢
- 页面加载缓慢
- 地图渲染卡顿

#### 优化建议

1. **减少检查点数量**
   - 分批规划路线
   - 优先选择重要检查点

2. **优化算法参数**
   - 减少蚁群算法迭代次数
   - 调整蚂蚁数量

3. **网络优化**
   - 使用稳定的网络连接
   - 检查网络延迟

4. **浏览器优化**
   - 关闭不必要的浏览器标签页
   - 清除浏览器缓存
   - 使用最新版本的浏览器

---

## 9. 附录

### 9.1 文件说明

#### 核心文件

- **index.html**：系统主页面，包含所有UI元素
- **script.js**：核心业务逻辑，包括路线规划、蚁群算法等
- **api.js**：API通信模块，封装所有后端API调用
- **styles.css**：页面样式文件
- **license_api.py**：后端API服务，提供数据查询和路线规划接口
- **db_config.py**：数据库配置文件

#### 配置文件

- **start_api.bat**：启动后端API服务的批处理文件
- **启动前端服务器.bat**：启动前端Web服务的批处理文件
- **手机测试配置.bat**：手机测试配置脚本
- **配置防火墙.bat**：防火墙配置脚本

#### 文档文件

- **使用手册.md**：本文档
- **系统架构设计.md**：系统架构设计文档
- **使用说明.md**：简要使用说明
- **手机测试说明.md**：手机端测试说明
- **手机无法访问-故障排查.md**：手机访问故障排查指南

### 9.2 API接口说明

#### 9.2.1 许可证搜索接口

```
GET /api/search/license/{licenseNumber}

响应示例：
{
  "许可证号": "320600123456",
  "客户名称": "某某商店",
  "经营地址": "某某路123号",
  "经度": 120.891467,
  "纬度": 31.974575
}
```

#### 9.2.2 路线规划接口

```
POST /api/plan/route

请求体：
{
  "points": [
    {
      "name": "起点",
      "longitude": 120.891467,
      "latitude": 31.974575
    }
  ],
  "strategy": "1"
}

响应示例：
{
  "distance": "25.6",
  "duration": 45,
  "segments": [
    {
      "from": {...},
      "to": {...},
      "distance": "5.2",
      "duration": 10,
      "polyline": [[lng, lat], ...]
    }
  ]
}
```

#### 9.2.3 地点搜索接口

```
GET /api/place/search?keyword={keyword}&city={city}

响应示例：
{
  "pois": [
    {
      "name": "地点名称",
      "address": "详细地址",
      "location": "120.891467,31.974575"
    }
  ]
}
```

### 9.3 数据库结构

#### 9.3.1 数据表

**表名**：`tobacco_retailers`（或自动检测的其他表名）

**字段说明**：

| 字段名 | 类型 | 说明 |
|--------|------|------|
| 许可证号 | VARCHAR | 主键，唯一标识 |
| 法人姓名 | VARCHAR | 企业法人 |
| 客户名称 | VARCHAR | 企业名称 |
| 经营地址 | VARCHAR | 详细地址 |
| 经度 | DECIMAL(10,6) | 经度坐标 |
| 纬度 | DECIMAL(10,6) | 纬度坐标 |

### 9.4 系统配置

#### 9.4.1 高德地图API配置

- **API Key**：需要在 `index.html` 中配置
- **API类型**：Web JS API
- **服务类型**：需要启用"Web服务API"权限

#### 9.4.2 数据库配置

在 `db_config.py` 中配置：

```python
DB_CONFIG = {
    'host': 'localhost',
    'user': 'root',
    'password': 'your_password',
    'database': 'locationnt',
    'port': 3306,
    'charset': 'utf8mb4'
}
```

#### 9.4.3 端口配置

- **后端API端口**：5001（可在 `license_api.py` 中修改）
- **前端Web端口**：8080（可在启动命令中修改）

### 9.5 快捷键说明

- **Enter键**：在搜索框中按Enter键可以快速搜索
- **Ctrl+F**：在浏览器中查找任务（快速定位）
- **F12**：打开浏览器开发者工具（调试用）

### 9.6 浏览器兼容性

| 浏览器 | 最低版本 | 推荐版本 |
|--------|---------|---------|
| Chrome | 60+ | 最新版 |
| Firefox | 55+ | 最新版 |
| Edge | 79+ | 最新版 |
| Safari | 12+ | 最新版 |
| 移动端浏览器 | 支持ES6 | 最新版 |

### 9.7 联系方式

如遇到问题或需要技术支持，请：

1. 查看本文档的"常见问题"和"故障排查"章节
2. 查看项目中的其他文档文件
3. 检查浏览器控制台和服务器日志
4. 联系系统管理员或开发团队

---

## 文档更新记录

| 版本 | 日期 | 更新内容 | 更新人 |
|------|------|---------|--------|
| v1.0 | 2024 | 初始版本，完整使用手册 | 开发团队 |

---

**© 2024 涉企行政检查路线规划系统. 保留所有权利.**




