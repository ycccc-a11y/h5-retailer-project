# Excel到MySQL数据导入工具使用说明

## 功能说明
本工具用于将Excel文件中的数据导入到MySQL数据库中，特别适用于处理"南通市烟草专卖局零售户经纬度.xlsx"文件。

## 文件结构
- `excel_to_mysql.py`: 主程序文件
- `db_config.py`: 数据库配置文件
- `南通市烟草专卖局零售户经纬度.xlsx`: 待导入的Excel数据文件
- `readme.txt`: 简要说明文件
- `license_api.py`: 许可证号码查询API服务
- `start_api.bat`: API服务器启动脚本

## 使用步骤

### 1. 安装依赖
确保已安装所需的Python库：
```bash
pip install pandas openpyxl pymysql sqlalchemy
```

### 2. 配置数据库连接
编辑 `db_config.py` 文件，修改以下参数：
- `host`: MySQL服务器地址（本地为localhost）
- `user`: 数据库用户名
- `password`: 数据库密码
- `database`: 数据库名称
- `port`: MySQL端口（默认3306）

### 3. 创建数据库（可选）
如果数据库不存在，程序会自动创建。你也可以手动创建：
```sql
CREATE DATABASE tobacco_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

### 4. 运行程序
在命令行中执行：
```bash
python excel_to_mysql.py
```

## 程序功能
1. 自动读取Excel文件
2. 显示数据预览和结构信息
3. 自动创建数据库（如果不存在）
4. 将数据导入到MySQL表中
5. 验证导入结果

## 数据表结构
导入后会创建`tobacco_retailers`表，包含以下字段：
- 许可证号
- 法人姓名
- 客户名称
- 经营地址
- 经度
- 维度

## 许可证号码搜索功能

### 启动API服务
1. 双击运行 `start_api.bat` 文件启动API服务
2. 或在命令行中执行: `python license_api.py`
3. API服务默认运行在端口5001

### 前端使用
1. 在浏览器中打开 `index.html`
2. 在"许可证号码搜索"区域输入许可证号码
3. 点击"搜索"按钮查询位置信息
4. 可以将查询结果添加到路线规划中

### API接口说明
- 单个许可证查询: `GET http://localhost:5001/api/search/license/{许可证号码}`
- 所有许可证查询(分页): `GET http://localhost:5001/api/search/license?page=1&page_size=20`

## 常见问题解决

### 1. 连接被拒绝
- 检查MySQL服务是否启动
- 检查数据库连接信息是否正确
- 检查防火墙设置

### 2. 权限不足
- 确保数据库用户具有创建表和写入数据的权限

### 3. 编码问题
- 程序使用utf8mb4字符集，支持中文和特殊字符

## 注意事项
1. 程序每次运行都会替换表中原有数据（if_exists='replace'）
2. 如需追加数据而非替换，请修改源代码中的if_exists参数为'append'
3. 确保Excel文件格式正确，第一行为列标题
4. 使用许可证搜索功能前请确保API服务已启动